<!DOCTYPE html>
<html>
<head>
    <title>API Auth Test</title>
    <script src="https://unpkg.com/amazon-cognito-identity-js@6.3.0/dist/amazon-cognito-identity.min.js"></script>
</head>
<body>
    <h1>API Authentication Test</h1>
    <button onclick="testVariousHeaders()">Test Various Auth Headers</button>
    <pre id="output"></pre>

    <script>
        const poolData = {
            UserPoolId: 'us-west-1_6IUovRAM1',
            ClientId: '1vk1puqortjm4kk08kh0u1otaj'
        };

        async function testVariousHeaders() {
            const output = document.getElementById('output');
            output.textContent = 'Testing various authentication methods...\n\n';
            
            const userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);
            const cognitoUser = userPool.getCurrentUser();
            
            if (!cognitoUser) {
                output.textContent = 'No user logged in';
                return;
            }
            
            cognitoUser.getSession(async (err, session) => {
                if (err || !session) {
                    output.textContent = 'No valid session';
                    return;
                }
                
                const accessToken = session.getAccessToken().getJwtToken();
                const idToken = session.getIdToken().getJwtToken();
                
                // Test different header formats
                const tests = [
                    {
                        name: 'Bearer + Access Token',
                        headers: {
                            'Authorization': 'Bearer ' + accessToken,
                            'Content-Type': 'application/json'
                        }
                    },
                    {
                        name: 'Bearer + ID Token',
                        headers: {
                            'Authorization': 'Bearer ' + idToken,
                            'Content-Type': 'application/json'
                        }
                    },
                    {
                        name: 'Access Token (no Bearer)',
                        headers: {
                            'Authorization': accessToken,
                            'Content-Type': 'application/json'
                        }
                    },
                    {
                        name: 'ID Token (no Bearer)',
                        headers: {
                            'Authorization': idToken,
                            'Content-Type': 'application/json'
                        }
                    },
                    {
                        name: 'X-Auth-Token header with Access Token',
                        headers: {
                            'X-Auth-Token': accessToken,
                            'Content-Type': 'application/json'
                        }
                    },
                    {
                        name: 'X-Auth-Token header with ID Token',
                        headers: {
                            'X-Auth-Token': idToken,
                            'Content-Type': 'application/json'
                        }
                    },
                    {
                        name: 'x-amz-security-token with Access Token',
                        headers: {
                            'x-amz-security-token': accessToken,
                            'Content-Type': 'application/json'
                        }
                    },
                    {
                        name: 'Cookie with Access Token',
                        headers: {
                            'Cookie': 'access_token=' + accessToken,
                            'Content-Type': 'application/json'
                        }
                    }
                ];
                
                for (const test of tests) {
                    output.textContent += `Testing: ${test.name}\n`;
                    try {
                        const response = await fetch('https://api.bigfootlive.io/api/v1/events/', {
                            method: 'GET',
                            headers: test.headers,
                            credentials: 'include'
                        });
                        
                        output.textContent += `  Status: ${response.status}\n`;
                        if (response.status === 200) {
                            output.textContent += `  âœ… SUCCESS! This format works!\n`;
                            const data = await response.json();
                            output.textContent += `  Response: ${JSON.stringify(data).substring(0, 100)}...\n`;
                        } else {
                            const text = await response.text();
                            output.textContent += `  Response: ${text}\n`;
                        }
                    } catch (e) {
                        output.textContent += `  Error: ${e}\n`;
                    }
                    output.textContent += '\n';
                }
                
                // Also test a public endpoint to verify API is reachable
                output.textContent += '\nTesting public health endpoint:\n';
                try {
                    const healthResponse = await fetch('https://api.bigfootlive.io/health');
                    output.textContent += `Health endpoint status: ${healthResponse.status}\n`;
                    const healthText = await healthResponse.text();
                    output.textContent += `Health response: ${healthText}\n`;
                } catch (e) {
                    output.textContent += `Health endpoint error: ${e}\n`;
                }
            });
        }
    </script>
</body>
</html>